<!DOCTYPE html>

<html>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Noticeboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="css/stylesheet.css">

    <script type="module">

        const host = location.protocol + '//' + location.hostname + ':' + location.port

        const apiBasePath = '/api/v1'

        const path = host + apiBasePath

        const contentContainer = document.querySelector('#contentContainer')

        init()

        async function init() {

            const isLoggedIn = await (await fetch(path + '/account/loginStatus')).json()

            if (!isLoggedIn) {

                const loginForm = document.querySelector('#loginTemplate').content.cloneNode(true)

                contentContainer.appendChild(loginForm)

                const form = document.querySelector('#loginForm')

                form.addEventListener('submit', async e => {

                    e.preventDefault();

                    const result = await fetch(path + '/account/login', {

                        method: 'POST',

                        headers: {

                            "Content-Type": "application/json"

                        },

                        body: JSON.stringify({

                            userName: form.querySelector('#userName').value,

                            password: form.querySelector('#password').value

                        })

                    })

                    if (result.ok) {

                        init()

                        form.remove()

                    }

                    document.querySelector('#messages').textContent = result.ok ? "login successful" : "login unsuccessful. code: " + result.status

                })

            } else {

                const button = document.createElement('button')

                button.innerText = 'log out'

                contentContainer.appendChild(button)

                button.addEventListener('click', async e => {

                    await fetch(path + '/account/logout')

                    button.remove()

                    init()

                })

            }

        }

    </script>

    <template id="loginTemplate">

        <form method="post" id="loginForm" class="login-container">

            <table>

                <tr>

                    <td class="">Username:</td>

                    <td>

                        <input id="userName" class="form-control input-margin" type="text" autofocus autocomplete="off" placeholder="Enter username" required>

                    </td>

                </tr>

                <tr>

                    <td>Password:</td>

                    <td>

                        <input id="password" class="form-control input-margin" type="password" placeholder="Enter password" required>

                    </td>

                </tr>

                <tr>

                    <td></td>

                    <td>

                        <button class="btn btn-primary btn-placement">Login</button>

                    </td>

                </tr>

            </table>

        </form>

    </template>

</head>

<body>

<div id="contentContainer"></div>

<div id="messages"></div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</body>
</html>

